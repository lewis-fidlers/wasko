#!/usr/bin/ruby

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')
require "rubygems"
require "wasko"
require "thor"

module Wasko
  class CLI < Thor
    include Thor::Actions

    map "-p" => :palette
    map "-l" => :list
    map "-b" => :background_color
    map "-c" => :cursor_color
    map "-t" => :text_color
    map "-f" => :font

    map "-w" => :save_color
    map "-r" => :load_color

    desc "palette", "Sets both back and foreground color adjusted to supplied hex_color"
    def palette(hex_color)
      Wasko.palette_from_color hex_color
    end

    desc "text_color", "Sets text color"
    def text_color(color_name="")
      if color_name.empty?
        say Wasko.foreground_color
      else
        Wasko.text_color color_name
      end
    end

    desc "background_color", "Sets background color"
    def background_color(color_name="")
      if color_name.empty?
        say Wasko.background_color
      else
        Wasko.background_color color_name
      end
    end

    desc "cursor_color", "Sets cursor color"
    def cursor_color(color_name="")
      if color_name.empty?
        say Wasko.cursor_color
      else
        Wasko.cursor_color color_name
      end
    end

    desc "font", "Sets font"
    def font(font_name = "", font_size = 14)
      if font_name.empty?
        say Wasko.font
      else
        Wasko.set_font font_name, font_size
      end
    end

    desc "load NAME", "Loads a stored theme"
    def load_color(name)
      if Wasko.saved_colors.include?(name)
        Wasko.load_color_from_config(name)
      else
        say "Please pick a theme from: [#{Wasko.saved_colors.join(", ")}]"
      end
    end

    desc "save NAME", "Saves current scheme to ~/.wasko"
    def save_color(name)
      rgbs = {
        :background => "{#{Wasko.current_background_color}}",
        :foreground => "{#{Wasko.current_normal_text_color}}"
      }
      Wasko.save_color_to_config(rgbs, name)
    end

    desc "list", "Lists all available colors"
    def list
      say Wasko.colors.join("\n")
    end

  end
end
Wasko::CLI.start
