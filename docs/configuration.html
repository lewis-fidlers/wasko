<!DOCTYPE html>  <html> <head>   <title>configuration.rb</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="wasko.html">                 wasko.rb               </a>                                           <a class="source" href="applescript.html">                 applescript.rb               </a>                                           <a class="source" href="color.html">                 color.rb               </a>                                           <a class="source" href="configuration.html">                 configuration.rb               </a>                                           <a class="source" href="palette.html">                 palette.rb               </a>                                           <a class="source" href="terminal.html">                 terminal.rb               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               configuration.rb             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nb">require</span> <span class="s2">&quot;fileutils&quot;</span>

<span class="k">module</span> <span class="nn">Wasko</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This class will handle all things considering
loading and saving configuration. It should work
like this.</p>

<ul>
<li>User sets all things to his liking</li>
<li>User writes to a <code>.color</code> file in <code>~/.wasko</code></li>
<li>User can share/edit this <code>.color</code> file</li>
<li>User can load <code>.color</code> file to restore settings</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">class</span> <span class="nc">Configuration</span>
    <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>All config files are stored in <code>~/.wasko/</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">wasko_directory</span>
        <span class="n">wasko_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;.wasko&quot;</span><span class="p">)</span>
        <span class="k">unless</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="n">wasko_path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="no">File</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">wasko_path</span><span class="p">)</span>
          <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;.wasko&quot;</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">wasko_path</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>All possible <code>.color</code> themes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">all_themes</span>
        <span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">wasko_directory</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
          <span class="no">Dir</span><span class="o">[</span><span class="s2">&quot;*.color&quot;</span><span class="o">].</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">filename</span><span class="o">|</span>
            <span class="n">filename</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\.color$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Blatantly stolen from <a href="http://stackoverflow.com/questions/1032104/regex-for-finding-valid-filename">here</a>
Spots all obvious bad filenames</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">valid_name?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="nb">name</span> <span class="o">=~</span> <span class="sr">/^[^\/?*:;{}\\]+$/</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>File path of the color theme file</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">config_file_with_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wasko_directory</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">.color&quot;</span><span class="p">)</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Setup the color theme with the hash.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">color_theme_from_hash</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span> <span class="k">unless</span> <span class="n">all_themes</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span> <span class="k">unless</span> <span class="no">Hash</span> <span class="o">===</span> <span class="no">YAML</span><span class="o">::</span><span class="nb">load</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">config_file_with_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)))</span>
        <span class="no">YAML</span><span class="o">::</span><span class="nb">load</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">config_file_with_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)))</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Transform a color theme to a hash</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">color_theme_to_hash</span>
        <span class="sx">%w(background_color foreground_color bold_color cursor_color font_size font_name)</span><span class="o">.</span><span class="n">inject</span><span class="p">({})</span> <span class="k">do</span> <span class="o">|</span><span class="nb">hash</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
          <span class="nb">hash</span><span class="o">[</span><span class="n">value</span><span class="o">]</span> <span class="o">=</span> <span class="no">Wasko</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
          <span class="nb">hash</span>
        <span class="k">end</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>Loading and saving colors</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Draw the saved colors</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">load_colors!</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="n">color_theme_from_hash</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">object</span><span class="p">,</span> <span class="n">color</span><span class="o">|</span>
          <span class="no">Wasko</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;set_</span><span class="si">#{</span><span class="n">object</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Write out the colors</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">save_colors!</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">config_file_with_name</span><span class="p">(</span><span class="nb">name</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
          <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">configuration_help</span><span class="p">)</span>
          <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">color_theme_to_hash</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">configuration_help</span>
        <span class="o">&lt;&lt;</span><span class="no">HELP</span>

<span class="sh">#DIVIDER</span>
<span class="no">HELP</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>This is a theme used by the wasko gem, it's nothing
more than regular yaml. So (ab)use as you would normally
do. The only thing to note is, colors take only valid
css colors and this comment can be deleted.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 